<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>축제 카드 API 통합 테스트</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .festival-card-enhanced {
            border: 1px solid #ddd;
            border-radius: 15px;
            overflow: hidden;
            transition: transform 0.3s;
            height: 100%;
        }
        .festival-card-enhanced:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .festival-flag {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 50px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .festival-weather {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        .festival-currency {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .festival-image-enhanced {
            height: 250px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">🌍 API 통합 축제 카드</h1>
        <div class="row" id="enhancedCards">
            <div class="col-12 text-center">
                <div class="spinner-border text-primary" role="status"></div>
                <p>카드 로딩 중...</p>
            </div>
        </div>
    </div>

    <script>
        // API 설정
        const festivalData = {
            tomatina: {
                id: 'tomatina',
                name: '라 토마티나',
                location: '스페인 발렌시아',
                period: '8월 마지막 수요일',
                price: 2200000,
                image: 'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=800',
                countryCode: 'es',
                currency: 'EUR',
                city: 'Valencia'
            },
            oktoberfest: {
                id: 'oktoberfest',
                name: '옥토버페스트',
                location: '독일 뮌헨',
                period: '9월 중순-10월 초',
                price: 2500000,
                image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800',
                countryCode: 'de',
                currency: 'EUR',
                city: 'Munich'
            },
            carnival: {
                id: 'carnival',
                name: '리우 카니발',
                location: '브라질 리우데자네이루',
                period: '2월-3월',
                price: 2800000,
                image: 'https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?w=800',
                countryCode: 'br',
                currency: 'BRL',
                city: 'Rio de Janeiro'
            }
        };

        // 환율 가져오기
        async function getExchangeRate(currency) {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/KRW');
                const data = await response.json();
                return data.rates[currency];
            } catch (error) {
                console.error('환율 로드 실패:', error);
                return null;
            }
        }

        // 날씨 가져오기 (OpenWeatherMap - 데모용)
        async function getWeather(city) {
            // 실제로는 API 키가 필요하지만, 데모용으로 임시 데이터 반환
            const mockWeather = {
                'Valencia': { temp: 28, icon: '☀️' },
                'Munich': { temp: 18, icon: '⛅' },
                'Rio de Janeiro': { temp: 32, icon: '🌤️' }
            };
            return mockWeather[city] || { temp: '--', icon: '🌡️' };
        }

        // 카드 생성
        async function createEnhancedCard(festival) {
            const rate = await getExchangeRate(festival.currency);
            const weather = await getWeather(festival.city);
            
            const localPrice = rate ? (festival.price * rate).toFixed(0) : '--';
            const formattedPrice = new Intl.NumberFormat('ko-KR').format(festival.price);
            
            return `
                <div class="col-md-4 mb-4">
                    <div class="festival-card-enhanced">
                        <div class="festival-image-enhanced" style="background-image: url('${festival.image}')">
                            <img src="https://flagcdn.com/w80/${festival.countryCode}.png" 
                                 alt="${festival.location}" 
                                 class="festival-flag">
                            <div class="festival-weather">
                                ${weather.icon} ${weather.temp}°C
                            </div>
                        </div>
                        <div class="p-3">
                            <h4>${festival.name}</h4>
                            <p class="text-muted mb-2">
                                <i class="fas fa-map-marker-alt"></i> ${festival.location}
                            </p>
                            <p class="text-muted mb-2">
                                <i class="fas fa-calendar"></i> ${festival.period}
                            </p>
                            <div class="mt-3">
                                <h5 class="text-primary">₩${formattedPrice}</h5>
                                <p class="festival-currency">
                                    약 ${new Intl.NumberFormat().format(localPrice)} ${festival.currency}
                                </p>
                            </div>
                            <button class="btn btn-primary w-100 mt-2">
                                <i class="fas fa-info-circle"></i> 자세히 보기
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // 카드 로드
        async function loadCards() {
            const container = document.getElementById('enhancedCards');
            container.innerHTML = '';
            
            for (const festival of Object.values(festivalData)) {
                const cardHTML = await createEnhancedCard(festival);
                container.insertAdjacentHTML('beforeend', cardHTML);
            }
        }

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', loadCards);
    </script>
</body>
</html>
